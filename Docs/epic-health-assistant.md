# Epic：HealthKit 智能分析与健康助手（基于 Spezi/LLM）

- **使命**：使 App 成为个人健康护理专家及助手，传递亲切、高效、专业的价值观与品牌形象。
- **参考**：`https://github.com/StanfordBDHG/HealthGPT`

## 目标与成功标准
- 业务目标：提升用户对健康数据的理解与行动力；建立可信赖的智能健康品牌体验。
- 成功指标：
  - DAU 提升 ≥ 20%；自然语言查询周活跃渗透 ≥ 35%。
  - 关键任务完成率 ≥ 70%；LLM 回答满意度 ≥ 75%。
  - 端到端 P95 时延 ≤ 5s；隐私合规事件 0；本地数据加密覆盖 100%。

## 范围（Scope）
- In-Scope：
  - 自然语言查询 HealthKit（步数、心率、睡眠、体重、静息心率、活动能量）。
  - 趋势/对比/阈值分析与解释；个性化建议与微目标；提醒与复盘。
  - Spezi 模块化框架：数据接入、查询规划、工具调用、可视化。
- Out-of-Scope（首期不做）：
  - 医疗诊断与风险分层；药物或医疗处方建议；非 HealthKit 云源接入。

## 用户旅程
- 查询：“我的平均心率是多少？过去 30 天趋势如何？”
- 洞察：“跑步日的睡眠质量有改善吗？与静息心率的关系？”
- 目标：“给我 7 天步数目标和可执行建议，并每天提醒我。”
- 复盘：“这周 vs 上周活动与睡眠变化？下一步做什么？”

## 架构（高层）
- App（SwiftUI + Spezi）
  - `HealthKitModule`：权限、同步、缓存（本地加密）
  - `QueryPlanner`：自然语言解析、意图参数化
  - `Toolbox`：聚合（均值、移动均值、分位数）、对比、相关性
  - `LLMOrchestrator`：提示模板、函数调用、结果校验与后处理
  - `InsightEngine`：洞察与个性化建议、目标引擎、提醒
  - `Visualization`：趋势/对比图与解释性注释
- 模型与推理：云端 LLM 优先，预留 on-device 选项；Schema 校验与安全网
- 数据与隐私：端侧优先存储与加密；用途明示；最小化；可导出/删除

## 里程碑
- M0（1-2 周）：Spezi + HealthKit 基础；最小 LLM 链路；本地加密
- M1（3-4 周）：意图解析 + 函数调用；常见查询；解释与可视化
- M2（3-4 周）：跨指标洞察；个性化目标与提醒；满意度反馈闭环
- M3（3-4 周）：多轮对话；周报/月报；性能与提示优化

## 验收标准
- M0：HealthKit 同步稳定（失败率 < 1%）；本地加密；手动查询通过
- M1：10+ 问法正确率 ≥ 85%；P95 ≤ 5s；解释项齐全
- M2：≥3 组联动洞察；建议可执行性 ≥ 4/5；提醒准时率 ≥ 99%
- M3：多轮对话成功率 ≥ 80%；周报留存提升 ≥ 10%；满意度 ≥ 80%

## 实施重点
- 提示工程：角色设定、澄清策略、函数调用 JSON Schema 校验与重试
- 数据规约：指标字典、单位与时间窗规范、缺失/异常值处理
- 性能：结果缓存、分段计算、流式响应；失败回退路径
- 体验：语气亲切专业、建议分层、默认简洁+细节可展开

## 依赖
- Apple HealthKit（iOS 17+）
- Spezi（模块化健康 App 框架）
- LLM 提供方（OpenAI/Azure/本地）
- 本地加密（Keychain/SQLCipher）


